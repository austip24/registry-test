{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "ol-map",
  "type": "registry:component",
  "title": "OpenLayers Map",
  "description": "Component that makes use of OpenLayers API",
  "dependencies": [
    "zustand",
    "ol"
  ],
  "files": [
    {
      "path": "registry/ol-map/components/map.tsx",
      "content": "\"use client\";\r\n\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport { MapBrowserEvent, Map as OLMap } from \"ol\";\r\nimport \"ol/ol.css\";\r\nimport { create } from \"zustand\";\r\nimport { MapOptions } from \"ol/Map\";\r\nimport BaseLayer from \"ol/layer/Base\";\r\nimport { FeatureLike } from \"ol/Feature\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\n// Zustand store to manage the map state\r\nexport type MapState = {\r\n  map: OLMap | null;\r\n};\r\n\r\nexport type MapActions = {\r\n  setMap: (map: OLMap) => void;\r\n};\r\n\r\nexport type MapStore = MapState & MapActions;\r\n\r\nconst useMapStore = create<MapStore>((set) => ({\r\n  map: null,\r\n  setMap: (map) => set({ map }),\r\n}));\r\n\r\n// Map component that allows custom properties\r\nexport const Map = ({\r\n  children,\r\n  options,\r\n  ...props\r\n}: {\r\n  children: React.ReactNode;\r\n  options: MapOptions;\r\n} & React.HTMLAttributes<HTMLElement>) => {\r\n  const mapContainerRef = useRef(null);\r\n  const setMap = useMapStore((state) => state.setMap);\r\n\r\n  useEffect(() => {\r\n    if (!mapContainerRef.current) return;\r\n\r\n    const map = new OLMap({\r\n      target: mapContainerRef.current,\r\n      ...options, // Spread custom map properties\r\n    });\r\n\r\n    setMap(map);\r\n\r\n    return () => {\r\n      map.setTarget();\r\n    };\r\n  }, [setMap, options]);\r\n\r\n  return (\r\n    <div\r\n      ref={mapContainerRef}\r\n      className={cn(\"absolute inset-0\", props.className)}\r\n      {...props}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\n// Map Layer component that adds a layer to the map\r\nexport const MapLayer = ({ layer }: { layer: BaseLayer }) => {\r\n  const map = useMapStore((state) => state.map);\r\n\r\n  useEffect(() => {\r\n    if (!map || !layer) return;\r\n\r\n    map.addLayer(layer);\r\n    return () => {\r\n      map.removeLayer(layer);\r\n    };\r\n  }, [map, layer]);\r\n\r\n  return <></>;\r\n};\r\n\r\n// Map Tooltip component\r\nexport const MapTooltip = ({\r\n  render,\r\n}: {\r\n  render: (feature: FeatureLike) => React.ReactNode;\r\n}) => {\r\n  const map = useMapStore((state) => state.map);\r\n  const [hoveredFeature, setHoveredFeature] = useState<FeatureLike | undefined>(\r\n    undefined\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (!map) return;\r\n\r\n    const handlePointerMove = (event: MapBrowserEvent<MouseEvent>) => {\r\n      const feature = map.forEachFeatureAtPixel(event.pixel, (feat) => feat);\r\n      setHoveredFeature(feature);\r\n    };\r\n\r\n    map.on(\"pointermove\", handlePointerMove);\r\n    return () => map.un(\"pointermove\", handlePointerMove);\r\n  }, [map]);\r\n\r\n  if (!hoveredFeature) return null;\r\n\r\n  return (\r\n    <div className=\"absolute z-50 bg-white p-2 shadow-md text-sm border rounded top-2 right-2\">\r\n      {render(hoveredFeature)}\r\n    </div>\r\n  );\r\n};\r\n",
      "type": "registry:component"
    },
    {
      "path": "registry/ol-map/example-map.tsx",
      "content": "\"use client\";\r\n\r\nimport { Feature, View } from \"ol\";\r\nimport { LineString, Point } from \"ol/geom\";\r\nimport TileLayer from \"ol/layer/Tile\";\r\nimport VectorLayer from \"ol/layer/Vector\";\r\nimport { OSM } from \"ol/source\";\r\nimport VectorSource from \"ol/source/Vector\";\r\nimport { Fill, Stroke, Style } from \"ol/style\";\r\nimport { Map, MapLayer, MapTooltip } from \"./components/map\";\r\nimport CircleStyle from \"ol/style/Circle\";\r\nimport { useEffect, useRef } from \"react\";\r\nimport { StyleLike } from \"ol/style/Style\";\r\n\r\n// Example usage with custom data\r\nexport const ExampleMap = () => {\r\n  const baseLayer = new TileLayer({\r\n    source: new OSM(),\r\n  });\r\n\r\n  // Sample point data\r\n  const features = [\r\n    new Feature({ geometry: new Point([0, 0]), name: \"Point A\" }),\r\n    new Feature({ geometry: new Point([1000000, 1000000]), name: \"Point B\" }),\r\n  ];\r\n\r\n  const lineStringFeatures = [\r\n    new Feature({\r\n      geometry: new LineString([\r\n        [0, 0],\r\n        [1000000, 1000000],\r\n      ]),\r\n      name: \"Line A\",\r\n    }),\r\n  ];\r\n\r\n  const pointStyleRef = useRef<StyleLike | undefined>(undefined);\r\n  const lineStringStyleRef = useRef<StyleLike | undefined>(undefined);\r\n\r\n  useEffect(() => {\r\n    const pointStyle = new Style({\r\n      image: new CircleStyle({\r\n        radius: 5,\r\n        fill: new Fill({ color: \"red\" }),\r\n        stroke: new Stroke({ color: \"black\", width: 1 }),\r\n      }),\r\n    });\r\n\r\n    const lineStringStyle = new Style({\r\n      stroke: new Stroke({\r\n        color: `hsl(${window\r\n          .getComputedStyle(document.documentElement)\r\n          .getPropertyValue(\"--chart-1\")})`,\r\n        width: 2,\r\n      }),\r\n    });\r\n\r\n    pointStyleRef.current = pointStyle;\r\n    lineStringStyleRef.current = lineStringStyle;\r\n  }, []);\r\n\r\n  features.forEach((feature) => feature.setStyle(pointStyleRef.current));\r\n  lineStringFeatures.forEach((feature) =>\r\n    feature.setStyle(lineStringStyleRef.current)\r\n  );\r\n\r\n  // Vector layer for custom points\r\n  const vectorLayer = new VectorLayer({\r\n    source: new VectorSource({ features }),\r\n  });\r\n\r\n  const lineStringLayer = new VectorLayer({\r\n    source: new VectorSource({ features: lineStringFeatures }),\r\n  });\r\n\r\n  return (\r\n    <Map options={{ view: new View({ center: [0, 0], zoom: 2 }) }}>\r\n      <MapLayer layer={baseLayer} />\r\n      <MapLayer layer={vectorLayer} />\r\n      <MapLayer layer={lineStringLayer} />\r\n      <MapTooltip render={(feature) => <div>{feature.get(\"name\")}</div>} />\r\n    </Map>\r\n  );\r\n};\r\n",
      "type": "registry:component"
    }
  ]
}